<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
  <title>Tidymodels DVC Mashup</title>

  <meta property="description" itemprop="description" content="Using Github Actions and Data Version Control for ModelOps in R"/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2020-10-26"/>
  <meta property="article:created" itemprop="dateCreated" content="2020-10-26"/>
  <meta name="article:author" content="Sean Lopp"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Tidymodels DVC Mashup"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Using Github Actions and Data Version Control for ModelOps in R"/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Tidymodels DVC Mashup"/>
  <meta property="twitter:description" content="Using Github Actions and Data Version Control for ModelOps in R"/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","categories","preview"]}},"value":[{"type":"character","attributes":{},"value":["Tidymodels DVC Mashup"]},{"type":"character","attributes":{},"value":["Using Github Actions and Data Version Control for ModelOps in R\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Sean Lopp"]}]}]},{"type":"character","attributes":{},"value":["10-26-2020"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["data_science"]},{"type":"character","attributes":{},"value":["modelops.png"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["images/modelops.png","images/paste-5761E6A6.png","images/Screen Shot 2020-10-26 at 1.13.24 PM.png","images/Screen Shot 2020-10-26 at 11.21.48 AM.png","images/Screen Shot 2020-10-26 at 12.34.25 PM.png","tidymodels-dvc-mashup_files/bowser-1.9.3/bowser.min.js","tidymodels-dvc-mashup_files/distill-2.2.21/template.v2.js","tidymodels-dvc-mashup_files/header-attrs-2.4.6/header-attrs.js","tidymodels-dvc-mashup_files/jquery-1.11.3/jquery.min.js","tidymodels-dvc-mashup_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for table of contents */

  .d-toc {
    color: rgba(0,0,0,0.8);
    font-size: 0.8em;
    line-height: 1em;
  }

  .d-toc-header {
    font-size: 0.6rem;
    font-weight: 400;
    color: rgba(0, 0, 0, 0.5);
    text-transform: uppercase;
    margin-top: 0;
    margin-bottom: 1.3em;
  }

  .d-toc a {
    border-bottom: none;
  }

  .d-toc ul {
    padding-left: 0;
  }

  .d-toc li>ul {
    padding-top: 0.8em;
    padding-left: 16px;
    margin-bottom: 0.6em;
  }

  .d-toc ul,
  .d-toc li {
    list-style-type: none;
  }

  .d-toc li {
    margin-bottom: 0.9em;
  }

  .d-toc-separator {
    margin-top: 20px;
    margin-bottom: 2em;
  }

  .d-article-with-toc {
    border-top: none;
    padding-top: 0;
  }



  /* Tweak code blocks (note that this CSS is repeated above in an injection
     into the d-code shadow dom) */

  d-code {
    overflow-x: auto !important;
  }

  pre.d-code code.d-code {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  pre.text-output {

    font-size: 12px;
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  @media(min-width: 768px) {

  d-code {
    overflow-x: visible !important;
  }

  pre.d-code code.d-code  {
      padding-left: 18px;
      font-size: 14px;
  }
  pre.text-output {
    font-size: 14px;
  }
  }

  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }



  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }


  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // create d-bibliography
    var bibliography = $('<d-bibliography></d-bibliography>');
    $('#distill-bibliography').wrap(bibliography);

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace citations with <d-cite>
    $('.citation').each(function(i, val) {
      appendix = true;
      var cites = $(this).attr('data-cites').split(" ");
      var dt_cite = $('<d-cite></d-cite>');
      dt_cite.attr('key', cites.join());
      $(this).replaceWith(dt_cite);
    });
    // remove refs
    $('#refs').remove();

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-toc a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // replace code blocks with d-code
    $('pre>code').each(function(i, val) {
      var code = $(this);
      var pre = code.parent();
      var clz = "";
      var language = pre.attr('class');
      if (language) {
        // map unknown languages to "clike" (without this they just dissapear)
        if ($.inArray(language, ["bash", "clike", "css", "go", "html",
                                 "javascript", "js", "julia", "lua", "markdown",
                                 "markup", "mathml", "python", "svg", "xml"]) == -1)
          language = "clike";
        language = ' language="' + language + '"';
        var dt_code = $('<d-code block' + language + clz + '></d-code>');
        dt_code.text(code.text());
        pre.replaceWith(dt_code);
      } else {
        code.addClass('text-output').unwrap().changeElementType('pre');
      }
    });

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('d-code, pre.text-output, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // table of contents
      if (have_authors) // adjust border if we are in authors
        $('.d-toc').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
      $('d-code').each(function(i, val) {
        var style = document.createElement('style');
        style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                          '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
        if (this.shadowRoot)
          this.shadowRoot.appendChild(style);
      });

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-toc-header').remove();
    $('.d-toc').remove();
    $('.d-toc-separator').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="tidymodels-dvc-mashup_files/header-attrs-2.4.6/header-attrs.js"></script>
  <script src="tidymodels-dvc-mashup_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="tidymodels-dvc-mashup_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="tidymodels-dvc-mashup_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="tidymodels-dvc-mashup_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Tidymodels DVC Mashup","description":"Using Github Actions and Data Version Control for ModelOps in R","authors":[{"author":"Sean Lopp","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#"}],"publishedDate":"2020-10-26T00:00:00.000-06:00","citationText":"Lopp, 2020"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Tidymodels DVC Mashup</h1>
<p><p>Using Github Actions and Data Version Control for ModelOps in R</p></p>
</div>

<div class="d-byline">
  Sean Lopp  
  
<br/>10-26-2020
</div>

<div class="d-article">
<p>I had a few goals in my first few days of vacation:</p>
<ol type="1">
<li>Figure out GitHub Actions.</li>
<li>Try out <a href="https://tidymodels.org"><code>tidymodels</code></a> , after being inspired by a R in Pharma talk on the <code>stacks</code> package.</li>
<li>Investigate this whole MLOps thing, and by investigate I meant <em>try it</em>, I did NOT go on vacation to read more Gartner Garbage ‚Ñ¢Ô∏è .</li>
</ol>
<p>As luck would have it, <a href="https://twitter.com/DrElleOBrien">@DrElleOBrien</a> happened to reach out about trying <a href="https://twitter.com/DrElleOBrien">DVC</a> with R. DVC is a framework for MLOps that can use GitHub actions, so I had the perfect excuse to knock out all three goals with one sample project.</p>
<p>If you don‚Äôt want the rambling story, here is the project: <a href="https://github.com/slopp/tidydvc" class="uri">https://github.com/slopp/tidydvc</a>.</p>
<h2 id="background">Background</h2>
<h3 id="dvc">DVC</h3>
<p><a href="https://dvc.org">DVC</a>, and its close companion <a href="https://cml.dev">CML</a>, provide tools for model management - think Git for data and models. The core idea is that a DVC pipeline tracks the input (files, data, hyper-parameters) to an experiment and the output of an experiment (model, metrics, etc). DVC can be used locally, but the real magic is that DVC can be combined with something like GitHub and GitHub actions to automate the experiment management. Just like a software engineer could create a PR to propose a change to code, a data scientist could create a PR to propose a change to a model. But, unlike in software engineering where the goal of a PR is to review and automatically test code changes, in ModelOps the goal of the PR would be to train a model and explain the outcome!</p>
<p>DVC is primarily built around Python, but I wanted to see if it could be used with R. In many ways it shares some of the principles of the <code>drake</code> (now <code>targets</code>) package, but with some added Git ‚ú®.</p>
<h3 id="tidymodels">Tidymodels</h3>
<p><a href="https://tidymodels.org">Tidymodels</a> is an opinionated workflow for model construction in R<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. It is kind of like scikit learn in the sense that many different algorithms are presented with a consistent interface.</p>
<p>A few interesting bits about tidymodels:</p>
<ol type="1">
<li>There is a concept of a <code>workflow</code> that allows you to track a model‚Äôs pre-processing steps and the model itself in one easy-to-use object. This turns out to be super helpful, though a bit at odds with DVC (or drake)‚Äôs concept of a pipeline‚Ä¶ more to come.</li>
<li>There are easy ways to <code>tune</code> hyper-parameters. Again, very helpful, but potentially at odds with external ModelOps-y things that want to control those elements.</li>
<li>There is experimental support for <a href="https://github.com/tidymodels/stacks">ensembles</a>, which is what I wanted to try!</li>
</ol>
<p><img src="images/paste-5761E6A6.png" title="The Delightful stacks Logo" style="width: 194px" alt="The Delightful stacks Logo" /><br />
</p>
<h3 id="mashup">Mashup</h3>
<p>Aside from learning the individual pieces, I wanted to see if it was possible to glue these different ecosystems together. As I hinted at above, however, there were some surface level concerns. It wasn‚Äôt clear to me if I could define clean boundaries between the concepts <code>tidymodels</code> wanted to control and what DVC expected to own. But the goal of PRs with beautiful <code>ggplots</code>was enticing. (Famous last words).</p>
<p>Final note, I also enjoy using R Markdown as a framework for data exploration and model creation. I find R Markdown encourages ‚Äúthinking while coding‚Äù. I definitely wanted R Markdown to play a role.</p>
<p>If you are interested in this type of mashup but want to play mostly in R, I highly recommend this article by David Neuzerling: <a href="https://mdneuzerling.com/post/machine-learning-pipelines-with-tidymodels-and-targets/">Machine Learning Pipelines with Tidymodels and Targets</a>.</p>
<h2 id="unstacking-stacks">Unstacking Stacks</h2>
<p>I began by creating an R Markdown document that roughly followed the outline of this <a href="https://stacks.tidymodels.org/articles/basics.html">stacks tutorial</a>. To spice things up, I decided to use the Ames Housing data, so my goal was to create an ensemble that predicted housing prices. You can follow the <a href="https://github.com/slopp/tidydvc/blob/main/fit_model.Rmd">code here</a>. Because one of my goals was to try tidymodels, here are some notes for future me on what I learned.<br />
<br />
</p>
<h3 id="dont-skip-eda">Don‚Äôt skip EDA</h3>
<p>I didn‚Äôt want to just copy code from Max‚Äôs <a href="https://www.tidymodels.org/learn/models/parsnip-ranger-glmnet/">parsnip regression tutorial</a> so instead I opted to write my own formula regressing on different predictors<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. I thought I could do this without any EDA. MISTAKE. I lost at least 2 hours fighting models that wouldn‚Äôt converge because my data was either incomplete or my pre-processing was non-sensical. I still am not happy with the results, but I did learn a valuable tactic. <em>When defining a recipe that will be used further down the line in a workflow, it is still a good idea (though not required) to prep and juice the recipe.</em> Essentially, this optional juicing allows you to SEE how the recipe is applied to your training dataset and troubleshoot any errors in a friendly space, as opposed to an unfriendly space (which is what I call a stack trace from the middle of a cross validation optimization routine that has failed because of a <code>NA</code>).</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# First define the recipe
housing_rec &lt;- recipe(SalePrice ~ ...) %&gt;% 
  update_role(PID, new_role = &quot;ID&quot;) %&gt;% 
  step_dummy(all_nominal()) %&gt;%  
  step_meanimpute(all_numeric()) %&gt;% 
  step_zv(all_predictors()) %&gt;% 
  step_nzv(all_predictors())

# Check it!
housing_rec %&gt;% 
  prep() %&gt;% 
  juice()

# Then do the rest of your workflow magic
housing_wflow &lt;- 
  workflow() %&gt;% 
  add_recipe(housing_rec)</code></pre>
</div>
<p><em>Tune</em></p>
<p>Tuning is easy. Getting the model out of the tune to actually use‚Ä¶ a little less intuitive. As with all things, I should have started by reading <a href="https://juliasilge.com/blog/sf-trees-random-tuning/">Julia Silge‚Äôs advice</a>. Essentially there are a couple things you (future me) need to know:</p>
<ol type="1">
<li>You create a model spec and stick it in a workflow:</li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# PS - for those who learned penalized regression through glmnet
# penalty = lambda 
# mixture = alpha
model_spec &lt;- linear_reg(penalty = tune(&quot;penalty&quot;), mixture = tune(&quot;mixture&quot;))

# the workflow ties your model to your pre-processing
model_wflow &lt;- 
  workflow() %&gt;% 
  add_recipe(preprocess_data) %&gt;% 
  add_model(model_spec)</code></pre>
</div>
<ol start="2" type="1">
<li>You can tune the model<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> using a grid:</li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
tune_results &lt;- 
  tune_grid(
    model_wflow,
    resamples = folds,  
    metrics = metric,  # think rmse
    control = control_grid() # controls what metadata is saved 
  )</code></pre>
</div>
<ol start="3" type="1">
<li>You can look at the tuned results:</li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# hint use the n function argument to see more. This is where you can find the actual tune parameters
show_best(tune_results)</code></pre>
</div>
<ol start="4" type="1">
<li>BUT, at this point, <em>you have to finalize the actual best model</em>. Or in the case of an ensemble, you have to finalize <em>many</em> models. Finalize means take the tuned parameters and fit the model on ALL the training data. (The parameters come from a model fit on a cross validation fold). To do this:</li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# select_best was counterintuitive to me... I found it hard to pull the data
# for all models; and it doesn&#39;t give you the best model, just the best
# tune parameters 
tuned_params &lt;- select_best(tune_results)

# use this object for future predictions
model_wflow_fit &lt;- finalize_workflow(model_wflow, tuned_params)

# final tip: to inspect the actual model 
model_wflow_fit %&gt;% 
  pull_workflow_fit() %&gt;% 
  broom::tidy() # linear models OR
  vip::vip() # trees</code></pre>
</div>
<p>At different points of this process it can be easy to forget what is trained and what is still a placeholder. The print methods are really good, use them.</p>
<h3 id="stacks">Stacks</h3>
<p>My final goal was to fit an ensemble model. Unfortunately, I hit an error using the <code>stacks</code> package. I suspect this error was due to the fact that the package is experimental and I had some stale dependencies. This left me between a rock and, well, another rock. I could have tried to nuke my environment and fight with <code>remotes</code> to install a bunch of development tidymodels packages. (This was made harder by the WIP change to <code>main</code> from <code>master</code> üëè). Or I could try to push forward by working around the error with my own ensemble code. I went for the latter path, and refreshed a lot of my statistical thinking along the way. (Recall <code>%*%</code> is how to do matrix multiplication in R). But I also killed 5 hours of vacation. ü§∑ I will spare you and my future self the details in the hope that the error is fixed, but a few conceptual tips:</p>
<ol type="1">
<li>The <code>stacks()</code> object starts with candidate models (from <code>tune_grid</code>) or a single model but with multiple fits (from <code>fit_resamples</code>). The magic this function does is align the different models based on the resample they used. In other words, if one candidate was fit on resample 1, it is matched with another candidate fit on resample 1. The same matching occurs within tuning configurations from a single model.<br />
</li>
<li>Under the hood, the ensemble is fit with glmnet, but buried in quite a few layers of tidymodels abstraction. <code>cv.glmnet</code> works as an alternative, but with a nasty side affect. You have to do all the work manually to get a final fitted object that glues all the prior models, workflows, and the ensemble together.<br />
</li>
<li>When those nice print methods I mentioned earlier fail, try <code>attributes</code> to see ‚Äúall the stuff‚Äù tidymodels is carrying around.</li>
</ol>
<h2 id="the-mashup"><strong>The Mashup</strong></h2>
<h3 id="adding-dvc">Adding DVC</h3>
<p><br />
*Once I had a functional R Markdown document that was fitting models, it was time to try this ModelOps thing. Now ModelOps can consist of a lot of things, but in this case I was interested in trying out the training side of model operations - tracking experiments and enabling collaboration. I‚Äôll save the monitoring side - deploying models to production and watching them overtime - for another vacation.</p>
<p>DVC is oriented around pipelines. Unfortunately, this appeared to clash a bit with my R Markdown workflow. For one, the R Markdown document ‚Äúdrove‚Äù all the modeling code, and this code was not amenable to being managed by an external pipeline. Another problem was that the tidymodels packages, especially <code>tune</code> and <code>stacks,</code> handled the parameters and ‚Äúexperiments‚Äù that DVC wanted to control.<br />
<br />
I decided to mostly ignore the first challenge. If my data was large, or the pre-processing intense, I think I would have benefited from breaking the R Markdown document into child documents that could each be a stage in a pipeline. In this case, I didn‚Äôt care for the extra overhead in saving intermediate results, and things were fast enough that I didn‚Äôt mind re-running steps from scratch. As I mentioned, I am advocate for using R Markdown instead of .R files even in the multi-stage approach. You an see an example of this <a href="https://github.com/sol-eng/bike_predict">‚Äúsplit it up‚Äù approach here</a>.</p>
<p>For the second problem, I decided to go with a hyper-hyper-parameter strategy. Essentially, I allowed <code>tune</code> and tidymodels to handle the hyper-parameter optimization within a model, but I used DVC to handle ‚Äúparameters‚Äù that would fundamentally change the type of model at play. In other words, my ‚ÄúPR experiments‚Äù amounted to asking questions like ‚Äúwhat if our ensemble uses ridge regression instead of LASSO?‚Äù as opposed to questions like ‚Äúwhat if each forest has more or less trees?‚Äù. Is this splitting hairs? You betcha. In fact, you can see artifacts in the code where I did use DVC for ‚Äú# of trees‚Äù and where I attempted to use the tidymodels code for optimizng the ensemble. My advice: ‚Äúexperiments‚Äù in most ModelOps settings come with overhead and complexity, so use them to track whatever changes really matter to you.</p>
<blockquote>
<p>In the current sate of MLOps, there aren‚Äôt great boundaries.</p>
</blockquote>
<p>I think this article explains this <a href="https://towardsdatascience.com/the-problem-with-ai-developer-tools-for-enterprises-and-what-ikea-has-to-do-with-it-b26277841661?gi=1a3a6ab5f7e7">nascent border-less state well</a>.<br />
<br />
One artifact of my toy exploration is that I also punted a bit on questions of scale. One of the claims of ModelOps is that, when adopted correctly, the training portion of experiments can easily be scaled across a wide variety of backends. I‚Äôll leave that test for another day, but in my experience ‚Äúmagic parallelism‚Äù is almost always a lie.</p>
<h3 id="pipeline-iteration">Pipeline Iteration</h3>
<figure>
<img src="images/Screen%20Shot%202020-10-26%20at%2011.21.48%20AM.png" title="Pipeline Failures" style="width: 435px" alt="Pipeline Failures" /><figcaption aria-hidden="true">Pipeline Failures</figcaption>
</figure>
<p>After settling on how I wanted to incorporate DVC into my example, it was time to try and get GitHub Actions working. This is where I thought my expertise in R package management would come in handy. I was right and wrong. On the plus side, I was successful. On the other hand, it was still hard.<br />
</p>
<p>Here are a few tips and tricks:</p>
<ol type="1">
<li>Elle created an <a href="https://github.com/elleobrien/actions_with_r">action workflow</a> that showed me how to use the <a href="https://github.com/r-lib/actions"><code>r-lib</code> Github actions</a> to install R in the context of a CML pipeline. Unfortunately, the r-lib actions are geared towards people testing packages, not people just running code. This discrepancy made our use case a bit awkward. In the future there will hopefully be actions geared at using R to simply run code.<br />
</li>
<li>I created an R script to wrap my <code>render::rmarkdown</code> call. This script did two things. First, it set the R repo option to use <a href="https://packagemanager.studio.com">Public Package Manager</a> to provide pre-built package binaries. This rapidly speeds up package install time. Second, the script calls <code>renv::restore</code>, which installs the packages I needed for my project. <a href="https://github.com/rstudio/renv">renv</a> is like the R equivalent to <code>pip freeze; pip install -r requirements.txt</code> .<br />
</li>
<li>Even though I was using pre-compiled R package binaries, some of them still had runtime system requirements. This meant I had to add a number of <code>apt-get install thing</code> lines to the actions file. I should have known this ahead of time and used Package Manager to identify what those requirements would be, but instead I did it the ‚Äúold fashioned‚Äù (read: painful) way of failing again and again until it worked.</li>
</ol>
<p>Overall, I think if I was doing a project like this for real, it‚Äôd be well worth my time to create a custom Docker image with my project environment and have the GitHub Action start by pulling that image. Otherwise you end up spending valuable iteration time waiting for the same packages to be installed.<br />
<br />
I also think this experience highlights the importance of local testing and experimentation. Running <code>dvc repro</code> to try out experiments locally was significantly faster for both troubleshooting and model exploration than waiting for the CI system to run. It is also much easier, locally, to explore metrics around model fit or interpretation that you may have forgotten to have your CI system write out. What this means:</p>
<ol type="1">
<li>Before CI/CD can be real for ModelOps, CI systems will need to be optimized for model operation performance.<br />
</li>
<li>Model management tools, like DVC pipelines, can be useful for organizing experiments and collaborating with others even without the CI part.<br />
</li>
<li>If you do go the CI route, remember that the environment is ephemeral, so be sure to save persistently <em>everything and anything</em> that might be useful for interactive debugging, model interpretation, etc later on.</li>
</ol>
<p>In general, I think we are a ways away from collaborating as seamlessly as software engineers do through Git. But, the state of the world is much much better than tracking model runs manually in a spreadsheet!<br />
<br />
</p>
<h3 id="the-magic-moment">The Magic Moment</h3>
<blockquote>
<p><em>‚ÄúThere is nothing quite as joyous as the rush one gets from a pipeline building when it had been failing‚Äù -every software engineer and soon every data scientist too</em></p>
</blockquote>
<p>This <a href="https://github.com/slopp/tidydvc/pull/2">PR shows you the results</a>, and here are a few of the happy screenshots:</p>
<figure>
<img src="images/Screen%20Shot%202020-10-26%20at%2012.34.25%20PM.png" title="Metric Diffs" alt="Metric Diffs" /><figcaption aria-hidden="true">Metric Diffs</figcaption>
</figure>
<figure>
<img src="images/modelops.png" title="DVC Pipeline with R" alt="DVC Pipeline with R" /><figcaption aria-hidden="true">DVC Pipeline with R</figcaption>
</figure>
<figure>
<img src="images/Screen%20Shot%202020-10-26%20at%201.13.24%20PM.png" title="GitHub PRs for ModelOps" alt="GitHub PRs for ModelOps" /><figcaption aria-hidden="true">GitHub PRs for ModelOps</figcaption>
</figure>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Tip: it is <a href="https://tidymodels.org" class="uri">https://tidymodels.org</a> NOT <a href="https://tidymodels.com‚Ä¶">https://tidymodels.com‚Ä¶</a><a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn2" role="doc-endnote"><p>My ultimate model did outperform the models in that tutorial ‚Ä¶. but lets all admit tutorial models are garbage and safely move on. Lest we get stuck on wondering why folks in Iowa value garage spaces over lot size.<a href="#fnref2" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn3" role="doc-endnote"><p>I am going to use model and workflow as synonyms for the rest of this section<a href="#fnref3" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
